<div class="container-fluid">
  <!-- <div class="content-body"> -->
  <div class="content-body">
    <div class="page-titles">
      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="javascript:void(0)" style="cursor: auto">Utils</a>
        </li>
        <li class="breadcrumb-item active">
          <a
            href="javascript:void(0)"
            style="cursor: auto; font-weight: 700 !important; color: black"
            >User-All</a
          >
        </li>
      </ol>
    </div>
    <div class="row mb-5 align-items-center">
      <div class="col-xl-2 mb-4 mb-xl-0">
        <a
          style="cursor: pointer; color: white !important"
          (click)="openModal()"
          type="button"
          data-toggle="modal"
          data-target=".bd-example-modal-lg"
          class="btn btn-primary light btn-lg btn-block rounded shadow px-2 buttons"
          ><i class="fa fa-plus mr-1"></i>Add Users</a
        >
      </div>
      <div class="col-xl-2 mb-4 mb-xl-0">
        <div class="media-body ml-1">
          <p class="mb-1 fs-14 text-center">Total User</p>
          <h3 class="mb-0 text-black font-w600 fs-20 text-center">
            {{ totalUser() }}
          </h3>
        </div>
      </div>
      <!-- <div class="col-xl-10">
      <div class="card m-0">
        <div class="card-body py-3 py-md-2">
          <div class="row align-items-center">
            <div class="col-md-5 mb-3 mb-md-0">
              <div class="media align-items-end">
                <span class="mr-2 mb-1">
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <g clip-path="url(#clip0)"></g>
                    <defs>
                      <clipPath id="clip0">
                        <rect width="24" height="24" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </span>
                <div class="media-body ml-1">
                  <p class="mb-1 fs-14">Total Users</p>
                  <h3 class="mb-0 text-black font-w600 fs-20">
                    {{ totalUser() }}
                  </h3>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> -->
    </div>

    <!-- API integration work starts here -->

    <div class="row">
      <div class="col-lg-12">
        <div class="table-responsive">
          <table
            id="example5"
            class="table display mb-4 table-responsive-xl dataTablesCard fs-14"
          >
            <thead>
              <tr>
                <th>Sr No</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Dealer Code</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of userList(); let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>{{ user.dealer_code }}</td>
                <td class="d-flex">
                  <a
                    href="javascript:void(0);"
                    data-target=".bd-example-modal-lg"
                    data-toggle="modal"
                    class="btn btn-primary shadow btn-xs sharp mr-1"
                    (click)="openModal(user)"
                    ><i class="fa fa-pencil"></i
                  ></a>
                  <!-- <a
                  href="javascript:void(0);"
                  data-target="#exampleModalCenter"
                  data-toggle="modal"
                  (click)="openModal(user)"
                >
                  <svg
                    width="25"
                    height="24"
                    viewBox="0 0 25 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M17.2557 2.99994C17.5201 2.73729 17.8341 2.52895 18.1796 2.38681C18.5251 2.24467 18.8954 2.17151 19.2694 2.17151C19.6433 2.17151 20.0136 2.24467 20.3591 2.38681C20.7046 2.52895 21.0186 2.73729 21.283 2.99994C21.5474 3.26258 21.7572 3.57438 21.9003 3.91754C22.0434 4.2607 22.1171 4.6285 22.1171 4.99994C22.1171 5.37137 22.0434 5.73917 21.9003 6.08233C21.7572 6.42549 21.5474 6.73729 21.283 6.99994L7.69086 20.4999L2.15332 21.9999L3.66356 16.4999L17.2557 2.99994Z"
                      stroke="#A0A0A0"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                </a> -->
                  <a
                    href="javascript:void(0);"
                    type="button"
                    class="btn btn-primary mb-2"
                    data-toggle="modal"
                    data-target=".bd-example-modal-sm"
                    class="btn btn-danger shadow btn-xs sharp"
                    (click)="selectUserForDeletion(user)"
                    ><i class="fa fa-trash"></i
                  ></a>
                  <div
                    class="modal fade bd-example-modal-sm"
                    tabindex="-1"
                    role="dialog"
                    aria-hidden="true"
                  >
                    <div class="modal-dialog modal-sm">
                      <div class="modal-content">
                        <div
                          class="modal-header text-center"
                          style="margin-inline: auto"
                        >
                          <h5 class="modal-title text-center">Delete User</h5>
                        </div>
                        <div class="modal-body">HEY ARE YOU OKAY..!</div>
                        <div class="modal-footer">
                          <button
                            type="button"
                            class="btn btn-outline-danger"
                            data-dismiss="modal"
                          >
                            Cancle
                          </button>
                          <button
                            type="button"
                            class="btn btn-outline-primary"
                            (click)="deleteUserId()"
                            data-dismiss="modal"
                          >
                            Delete
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<!-- <div class="modal fade" style="margin-block: 2em"> -->
<div
  class="modal fade bd-example-modal-lg custom-modal"
  tabindex="-1"
  role="dialog"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" style="text-align: center; width: 100%">
          {{ userObj.user_id ? "Edit User" : "Add New User" }}
        </h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form [formGroup]="useForm">
          <div class="row">
            <!-- Name -->
            <div class="col-md-6 form-group">
              <label for="name" class="form-label">Name</label>
              <input
                id="name"
                class="form-control form-control-lg"
                type="text"
                formControlName="name"
                placeholder="User Name"
                [(ngModel)]="userObj.name"
                [ngClass]="{
                  'is-invalid':
                    useForm.get('name')?.touched && useForm.get('name')?.invalid
                }"
                required
              />
              <div
                class="text-danger"
                *ngIf="
                  useForm.get('name')?.invalid && useForm.get('name')?.touched
                "
              >
                <span *ngIf="useForm.get('name')?.errors?.['required']"
                  >Name is required.</span
                >
              </div>
            </div>

            <!-- Department -->
            <div class="col-md-6 form-group">
              <label for="role" class="form-label">Department</label>
              <select
                id="role"
                class="form-control form-control-lg"
                formControlName="role"
                [(ngModel)]="userObj.role"
                [ngClass]="{
                  'is-invalid':
                    useForm.get('role')?.touched && useForm.get('role')?.invalid
                }"
              >
                <option value="" disabled>Select Department</option>
                <option value="admin">Admin</option>
                <option value="salesperson">Salesperson</option>
              </select>
              <div
                class="text-danger"
                *ngIf="
                  useForm.get('role')?.touched && useForm.get('role')?.invalid
                "
              >
                <span>Department is required.</span>
              </div>
            </div>

           
          </div>

          <div class="row">
            <!-- Account No -->
            <div class="col-md-6 form-group">
              <label for="account_id" class="form-label">Account No</label>
              <input
                id="account_id"
                class="form-control form-control-lg"
                formControlName="account_id"
                placeholder="Account Id"
                [(ngModel)]="userObj.account_id"
                [ngClass]="{
                  'is-invalid':
                    useForm.get('account_id')?.touched &&
                    useForm.get('account_id')?.invalid
                }"
              />
              <div
                class="text-danger"
                *ngIf="
                  useForm.get('account_id')?.invalid &&
                  useForm.get('account_id')?.touched
                "
              >
                <span *ngIf="useForm.get('account_id')?.errors?.['required']"
                  >Account Id is required.</span
                >
                <span *ngIf="useForm.get('account_id')?.errors?.['minlength']"
                  >Must be at least 12 characters long.</span
                >
              </div>
            </div>

            <!-- Email -->
            <div class="col-md-6 form-group">
              <label for="email" class="form-label">E-mail</label>
              <input
                id="email"
                class="form-control form-control-lg"
                formControlName="email"
                placeholder="E-mail"
                [(ngModel)]="userObj.email"
                [ngClass]="{
                  'is-invalid':
                    useForm.get('email')?.touched &&
                    useForm.get('email')?.invalid
                }"
              />
              <div
                class="text-danger"
                *ngIf="
                  useForm.get('email')?.invalid && useForm.get('email')?.touched
                "
              >
                <span *ngIf="useForm.get('email')?.errors?.['required']"
                  >Email is required.</span
                >
                <span *ngIf="useForm.get('email')?.errors?.['email']"
                  >Please enter a valid email address.</span
                >
              </div>
            </div>
          </div>

          <div class="row">
            <!-- Dealer Code -->
            <!-- <div class="col-md-6 form-group" [formGroup]="useForm">
              <label for="dealer_code" class="form-label">Dealer Code</label>
              <select
                id="dealer_id"
                class="form-control form-control-lg"
                formControlName="dealer_code"
                [(ngModel)]="userObj.dealer_id"
                (change)="onDealerChange()"
                [disabled]="!!userObj.user_id"
                [ngClass]="{
                  'is-invalid':
                    useForm.get('dealer_code')?.touched && useForm.get('dealer_code')?.invalid
                }"  
              >
                <option value="" disabled>Select Dealer</option>
                <option *ngFor="let dealer of dealerList()" [value]="dealer.dealer_id">
                  {{ dealer.dealer_code }}
                </option>
              </select>
              <div class="text-danger" *ngIf="useForm.get('dealer_code')?.touched && useForm.get('dealer_code')?.invalid">
                <span>Dealer is required.</span>
              </div>
            </div> -->
            <div class="col-md-6 form-group" [formGroup]="useForm">
              <label for="dealer_code" class="form-label">Dealer Code</label>
              <select
                id="dealer_code"
                class="form-control form-control-lg"
                formControlName="dealer_code"
                [(ngModel)]="userObj.dealer_id"
                (change)="onDealerChange()"
                [disabled]="!!userObj.user_id"
                [ngClass]="{
                  'is-invalid':
                    useForm.get('dealer_code')?.touched &&
                    useForm.get('dealer_code')?.invalid
                }"
              >
                <option value="" disabled>Select Dealer</option>
                <option
                  *ngFor="let dealer of dealerList()"
                  [value]="dealer.dealer_id"
                >
                  {{ dealer.dealer_code }}
                </option>
              </select>
              <div
                class="text-danger"
                *ngIf="
                  useForm.get('dealer_code')?.touched &&
                  useForm.get('dealer_code')?.invalid
                "
              >
                <span>Dealer is required.</span>
              </div>
            </div>

            <!-- Phone -->
            <div class="col-md-6 form-group">
              <label for="phone" class="form-label">Phone</label>
              <input
                id="phone"
                class="form-control form-control-lg"
                formControlName="phone"
                placeholder="Phone"
                [(ngModel)]="userObj.phone"
                [ngClass]="{
                  'is-invalid':
                    useForm.get('phone')?.touched &&
                    useForm.get('phone')?.invalid
                }"
              />
              <div
                class="text-danger"
                *ngIf="
                  useForm.get('phone')?.touched && useForm.get('phone')?.invalid
                "
              >
                <span *ngIf="useForm.get('phone')?.errors?.['required']"
                  >Phone is required.</span
                >
                <span *ngIf="useForm.get('phone')?.errors?.['minlength']"
                  >Must be at least 10 characters.</span
                >
                <span *ngIf="useForm.get('phone')?.errors?.['pattern']"
                  >Only numbers are allowed.</span
                >
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <!-- <button
          type="button"
          class="btn btn-outline-primary"
           [disabled]="
              !userObj.name ||
              !userObj.email ||
              !userObj.email ||
              !userObj.dealer_code ||
              !userObj.phone ||
              !userObj.role
            "
          (click)="userObj.user_id ? onUpdate() : onSave()"
          [attr.data-dismiss]="useForm.valid ? 'modal' : null"
        >
          {{ userObj.user_id ? "Update" : "Create" }}
        </button> -->
        <ng-container *ngIf="userObj.user_id; else saveButton">
          <button
            type="button"
            class="btn btn-outline-primary"
            (click)="onUpdate()"
            [disabled]="!isEmailChange()"
          >
            Edit
          </button>
        </ng-container>
        <ng-template #saveButton>
          <button
            type="button"
            class="btn btn-outline-primary"
            (click)="onSave()"
            [attr.data-dismiss]="useForm.valid ? 'modal' : null"
          >
            save
          </button>
        </ng-template>
        <button
          type="button"
          class="btn btn-outline-danger"
          data-dismiss="modal"
        >
          Close
        </button>
      </div>
    </div>
  </div>
</div>
